---
title: "CaseStudy2018"
author: "Ilse Beelen, Floor Komen and Lotte Pater"
date: "14 december 2018"
output:
  beamer_presentation:
    theme: "Warsaw"
    colortheme: "default"
    fonttheme: "structurebold"
---

```{r label = setup, echo = FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(
  dev.args = list(bg = 'transparent'),
  fig.align = "center",
  cache = FALSE
)
library("tidyverse")
library("car")
library("ggplot2")
library("reshape2")
library("plyr")
library("GGally")
library("Hmisc")
library("lattice")
library("survival")
library("formatR")
```
```{r}
setwd("~/Studie/Statistics & Data Science/Semester 1/Lineair models and Algebra/CaseStudyLineair2018")
#GetData

Data <- read.csv("1_clean_data/voting_and_demographics.csv",
                 stringsAsFactors=F, header = T) 


#Remove and rename columns
Data <- Data[,-15]
colnames(Data) <- c("Muni", "VVD","CDA","PVV", "D66", "SP", "GL","PvdA","CU","50PLUS","PvdD","SGP","FvD","DENK", "Urban_index", "High_edu_perc", "Mean_income", "Dutch_perc", "West_perc", "Non_west_perc")

# Non_west_perc is not linear. Therefore, we create a dummy variable with 3 levels
# Level 1: x < 5%
# Level 2: 5 <= x < 10%
# Level 3: x >= 10%
Data$Non_west <- ifelse(Data$Non_west_perc < 0.05, 1, NA)
Data$Non_west <- ifelse(Data$Non_west_perc >= 0.05 
                        & Data$Non_west_perc < 0.1, 2, Data$Non_west)
Data$Non_west <- ifelse(Data$Non_west_perc >= 0.1, 3, Data$Non_west)

Data$Non_west <- as.factor(Data$Non_west)

# Select the right variables and remove NAs
Dat_cda <- Data[,c(1,3,15,16,17,21)]
Dat_cda <- Dat_cda[complete.cases(Dat_cda),]




```
## Introduction and data summary 
Introductie later

- Parties to research: CDA and GroenLinks
- Demographics: Amount of 60+ residents, Non-west residents, mean income, highly educated residents 

<div class="centered">
<img src="Partijlandschap.jpg" alt = "" width="100%" height="100%">
</div>


## Data visualisation CDA 

```{r correlation_heatmap, echo=FALSE, warning=FALSE,message=FALSE,error=FALSE}
#### Correlation ####
# Correlation and p-value matrices
corrlist <- rcorr(as.matrix(Dat_cda[,-1]), type="pearson")
pvalues = data.frame(corrlist[["P"]])
correlation = round(data.frame(corrlist[["r"]]), digits = 3)

# Heatmap of the correlations
heatmap = ggcorr(Dat_cda[-1], 
                 low = "darkblue", mid = "lightyellow", high = "red",
                 label = T, label_size = 2.5, label_round = 3,   
                 color = 'black', size = 4, layout.exp = 2, hjust = 1) +
  ggtitle('Correlation between explanatory & respons variables ')

plot(heatmap)
```
```{r boxplots_code, echo=FALSE, warning=FALSE,message=FALSE,error=FALSE}
#### Boxplots ####
fill <- "#4271AE"
line <- "#1F3552"

# Plot Probability CDA votes VS Non-western residents
p1 <- ggplot(Dat_cda[complete.cases(Dat_cda),], aes(x = Non_west, y = CDA)) + 
  geom_boxplot(outlier.colour="black", 
               outlier.size=2, 
               outlier.fill =  "red",
               na.rm = F,
               fill = fill,
               color = line) +
  ggtitle("Votes for CDA per municipality") +
  xlab("Percentage of non-western residents") +
  ylab("Probability") +
  scale_x_discrete(labels = c("< 5%", "5-10%", "> 10 %")) 

# Plot Urbanity index VS Non-western residents
p2 <- ggplot(Dat_cda[complete.cases(Dat_cda),], 
             aes(x = Non_west, y = Urban_index)) + 
  geom_boxplot(outlier.colour="black", 
               outlier.size=2, 
               outlier.fill =  "red",
               na.rm = F,
               fill = fill,
               color = line) +
  ggtitle("Urbanity index against non-western residents") +
  xlab("Percentage of non-western residents") +
  ylab("Urbanity index") +
  ylim(c(0,4)) +
  scale_x_discrete(labels = c("< 5%", "5-10%", "> 10 %")) 
# Function to plot multiple plots together
multiplot <- function(..., plotlist=NULL, file, cols=2, layout=NULL) {
  library(grid)
  
  # Make a list from the ... arguments and plotlist
  plots <- c(list(...), plotlist)
  
  numPlots = length(plots)
  
  # If layout is NULL, then use 'cols' to determine layout
  if (is.null(layout)) {
    # Make the panel
    # ncol: Number of columns of plots
    # nrow: Number of rows needed, calculated from # of cols
    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                     ncol = cols, nrow = ceiling(numPlots/cols))
  }
  
  if (numPlots==1) {
    print(plots[[1]])
    
  } else {
    # Set up the page
    grid.newpage()
    pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))
    
    # Make each plot, in the correct location
    for (i in 1:numPlots) {
      # Get the i,j matrix positions of the regions that contain this subplot
      matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))
      
      print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                      layout.pos.col = matchidx$col))
    }
  }
}
```

```{r multi_boxplots, echo=FALSE, warning=FALSE,message=FALSE,error=FALSE, height=6}
multi_boxpl <- multiplot(p1, p2)

```
## Data visualisation GroenLinks 


## Data Cleaning 


## Formulate model 

```{r cars, echo = TRUE}
summary(cars)
```

## Final model

```{r pressure}
plot(pressure)
```

